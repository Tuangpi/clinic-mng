var supplierDetails=function(){let e=$("#supplierDetailsModal"),i=$("#supplierDetailsModalTitle"),t=e.find("#supplierId"),n=e.find("#name"),l=e.find("#contactPerson"),a=e.find("#description"),d=e.find("#address"),r=e.find("#state"),o=e.find("#city"),s=e.find("#zipCode"),c=e.find("#email"),u=e.find("#mobileNo"),p=e.find("#telNo"),f=e.find("#notes"),m=e.find("#isSupplier"),v=e.find("#isManufacturer");return{view:function(){cms.get(`${_url}/${_id}`,null,(function(b){var _;_=b.supplier,i.text(`${_.code} - ${_.name}`),t.text(_.code),n.text(_.name),l.text(_.contact_person),a.text(_.description),d.text(_.address),o.text(_.city?.description),r.text(_.city?.state?.description),s.text(_.zip_code),c.text(_.email),u.text(_.mobile_number),p.text(_.tel_number),f.text(_.notes),m.text(_.is_supplier?"Yes":"No"),v.text(_.is_manufacturer?"Yes":"No"),e.modal("show")}))}}}(),supplierForm=function(){let e=$("#supplierFormModal"),i=$("#supplierFormModalTitle"),t=$("#supplierForm"),n=t.find("#supplierId"),l=t.find("#name"),a=t.find("#contactPerson"),d=t.find("#description"),r=t.find("#address"),o=t.find("#state"),s=t.find("#city"),c=t.find("#zipCode"),u=t.find("#email"),p=t.find("#mobileNo"),f=t.find("#telNo"),m=t.find("#notes"),v=t.find("#isSupplier"),b=t.find("#isManufacturer"),_=e.find("#saveSupplier");return{init:function(){s.select2({placeholder:"Select City",dropdownParent:t}),o.select2({placeholder:"Select State/Region",dropdownParent:t}),_.click((function(){!function(){if(t.parsley().validate()){if(!v.is(":checked")&&!b.is(":checked"))return toastr.error("Please select atleast one in Supplier and Manufacturer"),!1;let e={name:l.val(),contactPerson:a.val(),description:d.val(),address:r.val(),city:s.val(),zipCode:c.val(),email:u.val(),mobileNo:p.val(),telNo:f.val(),notes:m.val(),isSupplier:v.is(":checked")?1:0,isManufacturer:b.is(":checked")?1:0};cms.saveForm(_id,e,_url,(function(){supplierList.reload(),0==_id&&h()}))}}()})),o.change((function(e,i){const n=this.value;""==n?s.html('<option value="" disabled selected></option>').select2({placeholder:"Select City",dropdownParent:t}):cms.get(`${_rootUrl}/states/${n}/cities`,null,(function(e){s.html('<option value="" disabled selected></option>').select2({placeholder:"Select City",dropdownParent:t,data:e.cities}),null!=i&&s.val(i).trigger("change")}))})),e.on("hidden.bs.modal",(function(){h()}))},view:function(){0==_id?(i.text("Create New Supplier"),e.modal("show")):(i.text("Edit Supplier Details"),cms.get(`${_url}/${_id}/edit`,null,(function(i){var t;t=i.supplier,n.val(t.code),l.val(t.name),a.val(t.contact_person),d.val(t.description),r.val(t.address),o.val(t.city.state_id).trigger("change",t.city_id),c.val(t.zip_code),u.val(t.email),p.val(t.mobile_number),f.val(t.tel_number),m.val(t.notes),v.prop("checked",t.is_supplier).trigger("change"),b.prop("checked",t.is_manufacturer).trigger("change"),e.modal("show")})))}};function h(){t[0].reset(),t.parsley().reset(),t.find("select").trigger("change")}}(),supplierList=function(){let e,i=$("#addSupplier"),t=$("#suppliersTable");return{init:function(){_isCurrentBranchAll&&i.remove();e=t.DataTable({processing:!0,serverSide:!0,ajax:_url,columns:[{data:null,name:"actions",searchable:!1,orderable:!1},{data:"code",name:"code"},{data:"name",name:"name"},{data:"contact_person",name:"contact_person"},{data:"city",name:"city"},{data:"mobile_number",name:"mobile_number"},{data:"tel_number",name:"tel_number"},{data:"email",name:"email"}],order:[[2,"asc"]],createdRow:function(e,i,t){let n=$(e);n.find("td:eq(0)").addClass("text-center").html(`<div class="btn-group dropend">\n                        <a href="#" class="dropdown-toggle text-primary" data-bs-toggle="dropdown">\n                        <i class="fa fa-ellipsis-vertical"></i>\n                        </a>\n                        <ul class="dropdown-menu dropdown-menu-end">\n                            <li><button id="edit${i.id}" class="dropdown-item edit fs-11px" type="button">Edit</button></li>\n                            <li><button id="del${i.id}" class="dropdown-item delete fs-11px" type="button">Delete</button></li>\n                        </ul>\n                    </div>`),n.find("td:eq(1)").html(`<a href="javascript:;" id="view${i.id}" class='view'>${i.code}</a>`)},drawCallback:function(){t.find(".edit").unbind("click").click((function(){_id=this.id.replace("edit",""),supplierForm.view()})),t.find(".delete").unbind("click").click((function(){cms.confirm("Delete Supplier","Are you sure you want to delete this record?",(()=>{cms.delete(`${_url}/${this.id.replace("del","")}`,null,(()=>{toastr.success("Supplier has been deleted.","Delete Supplier"),n()}))}))})),t.find(".view").unbind("click").click((function(){_id=this.id.replace("view",""),supplierDetails.view()}))},initComplete:function(){$("#suppliersTable_filter input").unbind(),$("#suppliersTable_filter input").keyup((function(i){13==i.keyCode&&e.search(this.value).draw()}))}}),i.click((function(){_id=0,supplierForm.view()}))},reload:n};function n(){e.ajax.reload(null,!1)}}();$((function(){$(document).ready((function(){supplierForm.init(),supplierList.init()}))}));
