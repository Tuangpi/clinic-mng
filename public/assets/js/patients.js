var pxVisitList=function(){const e=$("#visitsTable");let t=null;return{init:function(){!function(){null!=t&&t.clear().destroy();t=e.DataTable({processing:!0,serverSide:!0,ajax:`${_url}/${_id}/visits`,columns:[{data:"time_in",name:"time_in",render:function(e){return e?cms.formatDate(e):""}},{data:"code",name:"code"},{data:"appointment_schedule",name:"appointment_schedule",render:function(e){return e?cms.formatTime(e):""}},{data:"time_in",name:"time_in",render:function(e){return e?cms.formatTime(e):""}},{data:"time_out",name:"time_out",render:function(e){return e?cms.formatTime(e):""}},{data:"notes",name:"notes"},{data:"total_amount",name:"total_amount"},{data:"paid_amount",name:"paid_amount"},{data:"status",name:"status"}],order:[[0,"desc"]],createdRow:function(e,t,a){const n=$(e);n.find("td:eq(1)").html(`\n                    <a href="/queue?id=${t.id}" target="_blank">${t.code}</a>\n                `),n.find("td:eq(6)").html(`\n                <span class='${t.is_draft?"":"text-"+(null!=t.balance?"warning":"success")}'>${t.currency_symbol}${t.total_amount?cms.numberWithCommas(t.total_amount):"0.00"}</span>\n                    ${null!=t.balance?` <i class="fa-solid fa-circle-exclamation" data-bs-toggle="popover" data-bs-trigger="hover" data-bs-html="true" data-bs-title="Remaining Balance" data-bs-content="<div class='text-nowrap'>${t.balance}</div>"></i>`:""}`),n.find("td:eq(7)").html(`${t.currency_symbol}${null==t.paid_amount?"0.00":cms.numberWithCommas(t.paid_amount)}`)},drawCallback:function(){cms.initPopover()},initComplete:function(){$("#visitsTable_filter input").unbind().keyup((function(e){13==e.keyCode&&t.search(this.value).draw()}))}})}()},reload:function(){t.ajax.reload(null,!1)}}}(),pxLabel=function(){const e=$("#labelTablePrint"),t=e.find("#codeLabel"),a=e.find("#nricLabel"),n=e.find("#nameLabel"),i=e.find("#birthDateLabel"),o=e.find("#ageLabel"),l=e.find("#genderLabel"),s=e.find("#createdDateLabel"),r=e.find("#mobileLabel"),d=e.find("#addressLabel"),c=e.find("#cityZipCodeLabel"),u=e.find("#allergyLabel"),m=e.find("#nationalityLabel");return{printLabel:function(p=""){""==p&&(p=`${_url}/${_id}/label`);cms.get(p,null,(function(p){t.text(p.code),a.text(p.nric),n.text(p.name),i.text(cms.formatDate(p.birthDate)),o.text(`${p.age} y`),l.text(p.gender),s.text(moment(p.createdDate).format("DD MMM YYYY")),r.text(p.mobile),d.text(p.address),c.text(`${p.city} ${p.zipCode}`),u.text(p.allergy),m.text(p.nationality),e.print()}))}}}(),pxCreditList=function(){const e=$("#creditsTable");let t=null;return{init:function(){!function(){null!=t&&t.clear().destroy();t=e.DataTable({processing:!0,serverSide:!0,ajax:`${_url}/${_id}/credits`,columns:[{data:null,name:"actions",searchable:!1,orderable:!1},{data:"credit_date",name:"credit_date",render:function(e){return cms.formatDateTime(e)}},{data:"code",name:"code"},{data:"amount",name:"amount",render:function(e){let t="green";return e<0&&(t="danger"),`<span class="text-${t}">${cms.numberWithCommas(e)}</span>`}},{data:"created_by",name:"created_by"},{data:"remarks",name:"remarks"}],order:[[1,"desc"]],createdRow:function(e,t,a){$(e).find("td:eq(0)").addClass("text-center").html(0!=t.id?`<button id="del${t.id}" class="btn btn-primary btn-xs delete fs-11px" type="button" data-amount="${t.amount}"><i class="fa fa-trash"></i></button>`:"")},drawCallback:function(){e.find(".delete").unbind("click").click((function(){const e=$(this).data("amount");cms.confirm("Delete Credit","Are you sure you want to delete this record?",(()=>{cms.delete(`${_url}/${_id}/credits/${this.id.replace("del","")}`,null,(()=>{toastr.success("Credit has been deleted.","Delete Credit"),a(),pxCredits.updateCreditDisplay(cms.convertToDecimal(`-${e}`))}))}))}))},initComplete:function(){$("#creditsTable_filter input").unbind().keyup((function(e){13==e.keyCode&&t.search(this.value).draw()}))}})}()},reload:a};function a(){t.ajax.reload(null,!1)}}(),pxCredits=function(){const e=$("#creditModal"),t=e.find("#creditForm"),a=t.find("#addCreditContainer"),n=t.find("#addCredit"),i=t.find("#formContainer"),o=t.find("#date"),l=t.find("#amount"),s=t.find("#remarks"),r=i.find("#cancelCredit"),d=i.find("#saveCredit"),c=$("#creditDisplay");return{init:function(){o.datepicker({todayHighlight:!0}),new AutoNumeric("#amount",{minimumValue:1,watchExternalChanges:!0}),n.click((function(){o.datepicker("setDate",cms.currentDate()),a.fadeOut((function(){i.slideDown()}))})),r.click((function(){u(),i.slideUp((function(){a.fadeIn()}))})),d.click((function(){!function(){if(t.parsley().validate()){let e={date:cms.convertToDate(o.val()),amount:cms.convertToDecimal(l.val()),remarks:s.val()};cms.saveForm(0,e,`${_url}/${_id}/credits`,(function(){m(e.amount),u(),pxCreditList.reload(),pxList.reload()}))}}()})),e.on("hidden.bs.modal",(function(){r.trigger("click")}))},view:function(){pxCreditList.init(),e.modal("show")},updateCreditDisplay:m};function u(){t[0].reset(),t.parsley().reset(),l.val("")}function m(e){c.text(cms.numberWithCommas((cms.convertToDecimal(c.text())+e).toFixed(2)))}}(),pxCaseNotesAttachmentList=function(){let e=$("#caseNoteAttachmentsTable"),t=null;return{init:function(){!function(){null!=t&&t.clear().destroy();t=e.DataTable({processing:!0,serverSide:!0,ajax:`${_rootUrl}/case-notes/${_caseNoteId}/attachments`,columns:[{data:null,name:"actions",searchable:!1,orderable:!1},{data:"original_name",name:"original_name"},{data:"size",name:"size",render:function(e){return cms.humanFileSize(e,!1)}},{data:"created_at",name:"created_at",render:function(e){return cms.formatDate(e)}},{data:"created_by",name:"created_by"}],order:[[1,"asc"]],createdRow:function(e,t,a){$(e).find("td:eq(0)").addClass("text-center").html(`<div class="btn-group dropend">\n                        <a href="#" class="dropdown-toggle text-primary" data-bs-toggle="dropdown">\n                        <i class="fa fa-ellipsis-vertical"></i>\n                        </a>\n                        <ul class="dropdown-menu dropdown-menu-end">\n                            <li><a href="${_rootUrl}/case-note-files/${t.name}" class="dropdown-item fs-11px" type="button">Download</a></li>\n                            <li><button id="del${t.id}" class="dropdown-item delete fs-11px" type="button">Delete</button></li>\n                        </ul>\n                    </div>`)},drawCallback:function(){e.find(".delete").unbind("click").click((function(){cms.confirm("Delete File","Are you sure you want to delete this file?",(()=>{cms.delete(`${_rootUrl}/case-notes/${_caseNoteId}/attachments/${this.id.replace("del","")}`,null,(()=>{toastr.success("File has been deleted.","Delete File"),a()}))}))}))},initComplete:function(){$("#caseNoteAttachmentsTable_filter input").unbind(),$("#caseNoteAttachmentsTable_filter input").keyup((function(e){13==e.keyCode&&t.search(this.value).draw()}))}})}()},reload:a};function a(){t.ajax.reload(null,!1)}}(),pxCaseNotesAttachments=function(){let e,t=$("#attachFile"),a=$("#caseNoteAttachmentsModal"),n=$("#caseNoteAttachmentsModalTitle"),i=$("#attachmentContainer");return{init:function(){e=Dropzone.forElement("#caseNoteAttachmentsForm"),e.options.uploadMultiple=!0,e.options.parallelUploads=100,t.click((function(){l(!1)}))},viewForm:l,removeAllFiles:o,getFiles:function(){return e.files}};function o(){e.removeAllFiles()}function l(t){e.options.autoProcessQueue=t,e.options.addRemoveLinks=!t,t?(e.options.url=`${_rootUrl}/case-note-files/${_caseNoteId}/upload`,e.on("successmultiple",(function(e,t){pxCaseNotesAttachmentList.reload(),o()})),pxCaseNotesAttachmentList.init(),n.text("Attachments"),i.show()):(e.options.url="/",e.on("successmultiple",(function(e,t){})),n.text("Upoad a file"),i.hide()),a.modal("show")}}(),pxCaseNoteCommentForm=function(){let e=$("#message"),t=$("#saveComment"),a=$("#commentsContainer");return{init:function(){t.click((function(){n()})),e.keyup((function(e){13==e.which&&n()}))},registerDeleteEvent:o,appendComment:i};function n(){let t=e.val();if(""!=t){let a={message:t};cms.saveForm(0,a,`/case-notes/${_caseNoteId}/comments`,(function(a){e.val("");o(i(_currentUserPhoto,_currentUserFullName,a.commentDate,t,!0,a.id).find(".delete"))}))}}function i(e,t,n,i,o,l){return $(`\n        <div class="comment-container">\n            <div class="d-flex">\n                <img src="${e}" alt="" class="w-30px h-30px rounded" />\n                <div class="ps-3 flex-1">\n                    <strong class="mb-1">${t}</strong> - ${cms.formatDateTime(n)}\n                    <div class="mt-2">\n                    ${i}\n                    </div>\n                </div>\n                ${o?`<div class="btn-group">\n                        <a href="javascript:;" class="dropdown-toggle text-primary fs-20px" data-bs-toggle="dropdown">\n                            <i class="fa fa-ellipsis-vertical"></i>\n                        </a>\n                        <ul class="dropdown-menu dropdown-menu-end">\n                            <li><button id="del${l}" class="dropdown-item delete fs-11px"\n                                    type="button">Delete</button></li>\n                        </ul>\n                    </div>`:""}\n            </div>\n            <hr class="bg-gray-500" />\n        </div>`).prependTo(a)}function o(e){null==e&&(e=a.find(".delete")),e.click((function(){const e=$(this);cms.confirm("Delete Comment","Are you sure you want to delete this comment?",(()=>{cms.delete(`/case-notes/${_caseNoteId}/comments/${this.id.replace("del","")}`,null,(()=>{e.closest(".comment-container").fadeOut((function(){$(this).remove()})),toastr.success("Comment has been deleted.","Delete Comment")}))}))}))}}(),pxCaseNoteCommentList=function(){let e=$("#commentsContainer");return{initCommentList:function(){cms.get(`/case-notes/${_caseNoteId}/comments`,null,(function(e){for(let t=0;t<e.comments.length;t++){const a=e.comments[t],n=null!=a.user_photo_ext?`/storage/user-profile/${a.user_id}.${a.user_photo_ext}?v=${moment(a.user_updated_at).format("MMDDYYYYHHmmss")}`:_defaultPhotoSrc;pxCaseNoteCommentForm.appendComment(n,a.user,a.created_at,a.message,a.isCreator,a.id)}pxCaseNoteCommentForm.registerDeleteEvent()}))},clearComment:function(){e.html("")}}}(),pxCaseNoteDetails=function(){let e=$("#caseNoteDetailsModal"),t=$("#caseNoteDetailsModalTitle"),a=e.find("#userPhoto"),n=e.find("#userName"),i=e.find("#caseDate"),o=e.find("#caseType"),l=e.find("#caseContent");return{init:function(){e.on("hidden.bs.modal",(function(){a.attr("src","/assets/images/new-user.png"),pxCaseNoteCommentList.clearComment()}))},viewCaseNoteDetails:function(){cms.get(`${_url}/${_id}/case-notes/${_caseNoteId}`,null,(function(s){const r=s.caseNote;t.text(r.no),null!=r.creator.photo_ext&&a.attr("src",`/storage/user-profile/${r.creator.id}.${r.creator.photo_ext}?v=${moment(r.creator.updated_at).format("MMDDYYYYHHmmss")}`),n.text(`${r.creator.first_name} ${r.creator.last_name}`),i.text(cms.formatDateTime(r.case_date)),o.text(r.case_type.description),l.html(r.content),pxCaseNoteCommentList.initCommentList(),e.modal("show")}))}}}(),pxCaseNotesForm=function(){let e,t=$("#addNoteContainer"),a=$("#addNote"),n=$("#caseForm"),i=$(".case-note-form-container"),o=$("#caseType"),l=$("#template"),s=$("#caseDate"),r=$("#caseNoteContent"),d=$("#cancelCaseNote"),c=$("#draftCaseNote"),u=$("#saveCaseNote");return{init:function(){l.select2({placeholder:"Select Template",dropdownParent:n,allowClear:!0}),e=s.datetimepicker({format:"DD/MM/YYYY hh:mm A",keepOpen:!0,sideBySide:!0}),r.summernote({height:"200"}),a.click((function(){_caseNoteId=0,m()})),l.change((function(){!function(){const e=l.val();""!=cms.isNull(e)&&cms.get(`${_rootUrl}/case-note-templates/${e}/description`,null,(function(e){null!=e.description&&r.summernote("code",e.description)}))}()})),d.click((function(){p(),i.slideUp((function(){t.fadeIn()}))})),c.click((function(){f(1)})),u.click((function(){f(0)}))},viewCaseNoteForm:m};function m(){l.val("").trigger("change"),0==_caseNoteId?(c.show(),t.fadeOut((function(){i.slideDown()}))):cms.get(`${_url}/${_id}/case-notes/${_caseNoteId}/edit`,null,(function(a){o.val(a.caseNote.case_type_id),e.data("DateTimePicker").date(cms.formatDateTime(a.caseNote.case_date)),r.summernote("code",a.caseNote.content),a.caseNote.is_draft?c.show():c.hide(),t.fadeOut((function(){i.slideDown()}))}))}function p(){pxCaseNotesAttachments.removeAllFiles(),n[0].reset(),r.val("").summernote("reset"),n.parsley().reset(),n.find("select").trigger("change")}function f(e){if(n.parsley().validate()){var t=new FormData;t.append("caseType",o.val()),t.append("caseDate",cms.convertToDateTime(s.val())),t.append("content",r.val()),t.append("isDraft",e);const a=pxCaseNotesAttachments.getFiles();for(let e=0;e<a.length;e++){const n=a[e];t.append("attachments[]",n)}cms.saveFormWithFile(_caseNoteId,t,`${_url}/${_id}/case-notes`,(function(){0==_caseNoteId?p():e||c.hide(),pxCaseNotesAttachments.removeAllFiles(),pxCaseNotesList.reload()}))}}}(),pxCaseNotesList=function(){let e=$("#caseNotesTable"),t=null;return{init:function(){!function(){null!=t&&t.clear().destroy();t=e.DataTable({processing:!0,serverSide:!0,ajax:`${_url}/${_id}/case-notes`,columns:[{data:null,name:"actions",searchable:!1,orderable:!1},{data:null,name:"indicator",searchable:!1,orderable:!1},{data:"no",name:"no"},{data:"case_type",name:"case_type"},{data:"case_date",name:"case_date",render:function(e){return cms.formatDateTime(e)}},{data:"content",name:"content"},{data:"created_by",name:"created_by"}],order:[[2,"asc"]],createdRow:function(e,t,a){let n,i=$(e),o=i.find("td:eq(5)"),l=null!=t.deleted_at;l?(i.addClass("text-decoration-line-through"),n="muted"):n=t.is_draft?"yellow":"green",i.find("td:eq(0)").addClass("text-center").html(!t.is_draft||t.is_draft&&t.isCreator?`<div class="btn-group dropend">\n                        <a href="#" class="dropdown-toggle text-primary" data-bs-toggle="dropdown">\n                        <i class="fa fa-ellipsis-vertical"></i>\n                        </a>\n                        <ul class="dropdown-menu dropdown-menu-end">\n                            ${l?`<li><button id="revert${t.id}" class="dropdown-item revert fs-11px" type="button">Revert</button></li>`:`${t.isCreator?`<li><button id="edit${t.id}" class="dropdown-item edit fs-11px" type="button">Edit</button></li>`:""}\n                            <li><button id="del${t.id}" class="dropdown-item delete fs-11px" type="button">${t.is_draft?"Delete":"Scrap"} Note</button></li>\n                            `}\n                            <li>\n                                <hr class="dropdown-divider">\n                            </li>\n                            <li><button id="attachments${t.id}" class="dropdown-item attachments fs-11px" type="button">Attachments</button></li>\n                        </ul>\n                    </div>`:""),i.find("td:eq(1)").addClass("text-center").html(`<i class="fa fa-circle text-${n}"></i>`),i.find("td:eq(2)").html(`<a href="javascript:;" id="view${t.id}" class='view'>${t.no}</a>`),o.html($("<div/>").html(t.content).text());const s=o.find("p").length>1;o.html(o.text()+(s?"...":""))},drawCallback:function(){e.find(".edit").unbind("click").click((function(){_caseNoteId=this.id.replace("edit",""),pxCaseNotesForm.viewCaseNoteForm()})),e.find(".delete").unbind("click").click((function(){const e=$(this).text();let t="delete",a="deleted";"Scrap Note"==e&&(t="scrap",a="scrapped"),cms.confirm(e,`Are you sure you want to ${t} this record?`,(()=>{cms.delete(`${_url}/${_id}/case-notes/${this.id.replace("del","")}`,null,(()=>{toastr.success(`Note has been ${a}.`,e),pxCaseNotesList.reload()}))}))})),e.find(".revert").unbind("click").click((function(){cms.confirm("Revert Note","Are you sure you want to revert this record?",(()=>{cms.put(`${_url}/${_id}/case-notes/${this.id.replace("revert","")}/revert`,null,(()=>{toastr.success("Note has been reverted.","Revert Note"),pxCaseNotesList.reload()}))}))})),e.find(".view").unbind("click").click((function(){_caseNoteId=this.id.replace("view",""),pxCaseNoteDetails.viewCaseNoteDetails()})),e.find(".attachments").unbind("click").click((function(){_caseNoteId=this.id.replace("attachments",""),pxCaseNotesAttachments.viewForm(!0)}))},initComplete:function(){$("#caseNotesTable_filter input").unbind(),$("#caseNotesTable_filter input").keyup((function(e){13==e.keyCode&&t.search(this.value).draw()}));const e=$("#caseNotesTable_filter"),a=$("#caseType").clone().attr("id","caseTypeFilter").addClass("d-inline-block w-auto ms-2");a.children().eq(0).removeAttr("disabled").text("All Case Type"),e.append(a),a.change((function(){t.ajax.url(`${_url}/${_id}/case-notes?case_type=${this.value}`).load()})),e.append('<i id="indicatorLegend" class="fa fa-info-circle text-muted fs-12px ms-2" data-bs-toggle="popover" data-bs-trigger="hover" data-bs-html="true"\n                        data-bs-title="Legend Indicator" data-bs-placement="right"\n                        data-bs-content="\n                        <i class=\'fa fa-circle text-green mb-2\'></i> Posted Note<br/>\n                        <i class=\'fa fa-circle text-yellow mb-2\'></i> Draft Note<br/>\n                        <i class=\'fa fa-circle text-muted\'></i> Scrap Note\n                        "></i>');const n=document.getElementById("indicatorLegend");new bootstrap.Popover(n)}})}()},reload:function(){t.ajax.reload(null,!1)}}}(),pxDetails=function(){let e=$("#patientDetailsModal"),t=$("#patientDetailsModalTitle"),a=e.find("#patientVisitsLink"),n=e.find("#photoPreview"),i=$("#patientRecordsLink"),o=$("#patientDetailsLink"),l=e.find("#patientId"),s=e.find("#title"),r=e.find("#firstName"),d=e.find("#lastName"),c=e.find("#birthDate"),u=e.find("#birthPlace"),m=e.find("#gender"),p=e.find("#nationality"),f=e.find("#maritalStatus"),h=e.find("#nric"),b=e.find("#address"),_=e.find("#city"),v=e.find("#state"),g=e.find("#zipCode"),x=e.find("#mobileNo"),C=e.find("#email"),w=e.find("#drugAllergies"),y=e.find("#foodAllergies"),D=e.find("#notes"),N=e.find("#showCredits"),k=e.find("#creditDisplay");return{init:function(){_isCurrentBranchAll&&N.remove();e.on("hidden.bs.modal",(function(){i[0].click(),o[0].click()})),a.click((function(){pxVisitList.init()})),N.click((function(){pxCredits.view()}))},viewPatientDetails:function(){pxCaseNotesList.init(),cms.get(`${_url}/${_id}`,null,(function(a){var i;k.text(cms.numberWithCommas(a.credits)),i=a.patient,t.text(`${i.code} - ${i.full_name} - ${i.age}y - ${i.gender?.description}`),l.text(i.code),s.text(i.title?.description),r.text(i.first_name),d.text(i.last_name),c.text(cms.formatDate(i.birth_date)),u.text(i.birth_place),m.text(i.gender?.description),p.text(i.nationality?.description),f.text(i.marital_status?.description),h.text(i.nric),b.text(i.address),_.text(i.city?.description),v.text(i.city?.state?.description),g.text(i.zip_code),x.text(i.mobile_number),C.text(i.email),w.text(`${null==i.has_drug_allergies?"Unknown":1==i.has_drug_allergies?"Yes":"No"}${null!=i.drug_allergies&&""!=i.drug_allergies?` - ${i.drug_allergies}`:""}`),y.text(`${null==i.has_food_allergies?"Unknown":1==i.has_food_allergies?"Yes":"No"}${null!=i.food_allergies&&""!=i.food_allergies?` - ${i.food_allergies}`:""}`),D.text(i.notes),null!=i.photo_ext&&n.attr("src",`/storage/profile/${i.id}.${i.photo_ext}?v=${moment(i.updated_at).format("MMDDYYYYHHmmss")}`),e.modal("show")}))}}}(),pxForm=function(){let e,t=$("#patientFormModal"),a=$("#patientFormModalTitle"),n=$("#patientForm"),i=$("#photoPreview"),o=$("#removePhoto"),l=$("#photo"),s=$("#photoImage"),r=new FileReader,d=$("#photoCamera"),c=$("#cameraModal"),u=$("#capture"),m=$("#patientId"),p=$("#title"),f=$("#firstName"),h=$("#lastName"),b=$("#birthDate"),_=$("#birthPlace"),v=$("#gender"),g=$("#nationality"),x=$("#maritalStatus"),C=$("#nric"),w=$("#address"),y=$("#state"),D=$("#city"),N=$("#zipCode"),k=$("#mobileNo"),T=$("#email"),A=$("#hasDrugAllergies"),L=$("#drugAllergies"),F=$("#hasFoodAllergies"),P=$("#foodAllergies"),S=$("#notes"),Y=$("#addPatientToTheQueueContainer"),M=$("#addPatientToTheQueue"),I=$("#savePatient");return{init:function(){$(".datepicker").datepicker({todayHighlight:!0}),p.select2({placeholder:"Select Title",dropdownParent:n}),v.select2({placeholder:"Select Gender",dropdownParent:n}),g.select2({placeholder:"Select Nationality",dropdownParent:n}),x.select2({placeholder:"Select Marital Status",dropdownParent:n}),D.select2({placeholder:"Select City",dropdownParent:n}),y.select2({placeholder:"Select State/Region",dropdownParent:n}),A.select2({placeholder:"Select Drug Allergies",dropdownParent:n}),F.select2({placeholder:"Select Other Conditions",dropdownParent:n}),s.click((e=>{e.stopPropagation(),l.click()})),l.on("change",(()=>{r.readAsDataURL(l.prop("files")[0])})),r.onloadend=e=>{i.attr("src",e.target.result),o.removeClass("hide")},o.click((function(){l.val(""),i.attr("src",_defaultPhotoSrc),o.addClass("hide")})),d.click((async function(){let e=document.querySelector("#video"),t=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});e.srcObject=t,c.modal("show")})),c.on("hidden.bs.modal",(function(){const e=document.querySelector("#video").srcObject.getTracks();e[0].stop(),e.forEach((e=>e.stop()))})),u.click((function(e){let t=document.querySelector("#canvas");t.getContext("2d").drawImage(video,0,0,t.width,t.height),i.attr("src",t.toDataURL("image/jpeg")),l.val(""),o.removeClass("hide")})),y.change((function(e,t){const a=this.value;""==a?D.html('<option value="" disabled selected></option>').select2({placeholder:"Select City",dropdownParent:n}):cms.get(`${_rootUrl}/states/${a}/cities`,null,(function(e){D.html('<option value="" disabled selected></option>').select2({placeholder:"Select City",dropdownParent:n,data:e.cities}),null!=t&&D.val(t).trigger("change")}))})),A.change((function(){1==this.value?L.attr("required",!0).removeAttr("disabled"):L.val("").attr("disabled",!0).removeAttr("required")})),F.change((function(){1==this.value?P.attr("required",!0).removeAttr("disabled"):P.val("").attr("disabled",!0).removeAttr("required")})),I.click((function(){!function(){if(n.parsley().validate()){let t={title:p.val(),firstName:f.val(),lastName:h.val(),birthDate:cms.convertToDate(b.val()),birthPlace:_.val(),gender:v.val(),nationality:g.val(),maritalStatus:x.val(),nric:C.val(),address:w.val(),city:D.val(),zipCode:N.val(),mobileNo:k.val(),email:T.val(),hasDrugAllergies:A.val(),drugAllergies:L.val(),hasFoodAllergies:F.val(),foodAllergies:P.val(),notes:S.val(),addPatientToTheQueue:M.is(":checked")?1:0,photoExt:e};i.attr("src")!=_defaultPhotoSrc?null!=r.result&&l.prop("files").length>0?(t.photo=r.result.split("base64,")[1],t.photoExt=l.prop("files")[0].name.split(".").pop()):i.attr("src").indexOf("base64")>=0&&(t.photo=i.attr("src").split("base64,")[1],t.photoExt="jpg"):t.photoExt=null,cms.saveForm(_id,t,_url,(function(){pxList.reload(),0==_id&&q()}))}}()})),t.on("hidden.bs.modal",(function(){q()}))},viewPatientForm:function(){0==_id?(a.text("Create New Patient"),Y.visible(),o.addClass("hide"),t.modal("show")):(a.text("Edit Patient Details"),o.removeClass("hide"),Y.invisible(),cms.get(`${_url}/${_id}/edit`,null,(function(a){!function(t){m.val(t.code),p.val(t.title_id).trigger("change"),f.val(t.first_name),h.val(t.last_name),b.datepicker("setDate",cms.formatDate(t.birth_date)),_.val(t.birth_place),v.val(t.gender_id).trigger("change"),g.val(t.nationality_id).trigger("change"),x.val(t.marital_status_id).trigger("change"),C.val(t.nric),w.val(t.address),null!=t.city&&y.val(t.city.state_id).trigger("change",t.city_id);N.val(t.zip_code),k.val(t.mobile_number),T.val(t.email),A.val(null==t.has_drug_allergies?0:1==t.has_drug_allergies?1:2).trigger("change"),L.val(t.drug_allergies),F.val(null==t.has_food_allergies?0:1==t.has_food_allergies?1:2).trigger("change"),P.val(t.food_allergies),S.val(t.notes),e=t.photo_ext,null!=t.photo_ext?i.attr("src",`/storage/profile/${t.id}.${t.photo_ext}?v=${moment(t.updated_at).format("MMDDYYYYHHmmss")}`):o.addClass("hide")}(a.patient),t.modal("show")})))}};function q(){i.attr("src",_defaultPhotoSrc),n[0].reset(),n.parsley().reset(),n.find("select").trigger("change")}}(),pxList=function(){let e,t=$("#addPatient"),a=$("#patientsTable");return{init:function(){_isCurrentBranchAll&&t.remove();e=a.DataTable({processing:!0,serverSide:!0,ajax:_url,columns:[{data:null,name:"actions",searchable:!1,orderable:!1},{data:null,name:"image",searchable:!1,orderable:!1},{data:"code",name:"code"},{data:"name",name:"name"},{data:"city",name:"city"},{data:"mobile_number",name:"mobile_number"},{data:"birth_date",name:"birth_date",render:function(e){return cms.formatDate(e)}},{data:"available_credits",name:"available_credits",render:function(e){return null!=e?cms.numberWithCommas(e):""}},{data:"branch",name:"branch"}],order:[[2,"asc"]],createdRow:function(e,t,a){let n=$(e);n.find("td:eq(0)").addClass("text-center").html(`<div class="btn-group dropend">\n                        <a href="#" class="dropdown-toggle text-primary" data-bs-toggle="dropdown">\n                        <i class="fa fa-ellipsis-vertical"></i>\n                        </a>\n                        <ul class="dropdown-menu dropdown-menu-end">\n                            <li><button id="edit${t.id}" class="dropdown-item edit fs-11px" type="button">Edit</button></li>\n                            <li><button id="del${t.id}" class="dropdown-item delete fs-11px" type="button">Delete</button></li>\n                            <li><button id="print${t.id}" class="dropdown-item print fs-11px" type="button">Print Label</button></li>\n                        </ul>\n                    </div>`),n.find("td:eq(1)").addClass("text-center").html(`<img src="/${null!=t.photo_ext?`storage/profile/${t.id}.${t.photo_ext}?v=${moment(t.updated_at).format("MMDDYYYYHHmmss")}`:_defaultPhotoSrc}" class="rounded h-30px my-n1 mx-n1">`),n.find("td:eq(2)").html(`<a href="javascript:;" id="view${t.id}" class='view'>${t.code}</a>`)},drawCallback:function(){a.find(".edit").unbind("click").click((function(){_id=this.id.replace("edit",""),pxForm.viewPatientForm()})),a.find(".delete").unbind("click").click((function(){cms.confirm("Delete Patient","Are you sure you want to delete this record?",(()=>{cms.delete(`${_url}/${this.id.replace("del","")}`,null,(()=>{toastr.success("Patient has been deleted.","Delete Patient"),pxList.reload()}))}))})),a.find(".view").unbind("click").click((function(){_id=this.id.replace("view",""),pxDetails.viewPatientDetails()})),a.find(".print").unbind("click").click((function(){_id=this.id.replace("print",""),pxLabel.printLabel()}))},initComplete:function(){$("#patientsTable_filter input").unbind(),$("#patientsTable_filter input").keyup((function(t){13==t.keyCode&&e.search(this.value).draw()}));const t=$(`<select id="branchFilter" class="d-inline-block w-auto ms-2 form-select form-select-sm">\n                                        <option value="">All Branches</option>\n                                        ${$("#branchList").find(".dropdown-item").not("#br0").map((function(){return`<option value=${this.id.replace("br","")}>${this.text}</option>`})).get().join("")}\n                                        </select>`);$("#patientsTable_filter").append(t),t.change((function(){e.ajax.url(`${_url}?branch=${this.value}`).load()}))}}),t.click((function(){_id=0,pxForm.viewPatientForm()}))},reload:function(){e.ajax.reload(null,!1)}}}();$((function(){$(document).ready((function(){pxList.init(),pxForm.init(),pxDetails.init(),pxCaseNotesForm.init(),pxCaseNoteDetails.init(),pxCaseNoteCommentForm.init(),pxCaseNotesAttachments.init(),pxCredits.init()}))}));
