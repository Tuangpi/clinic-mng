var branchDetails=function(){let e=$("#branchDetailsModal"),t=$("#branchDetailsModalTitle"),n=e.find("#branchId"),i=e.find("#name"),a=e.find("#currencySymbol"),c=e.find("#printHeader"),d=e.find("#telNo"),l=e.find("#coRegNo"),r=e.find("#address"),o=e.find("#state"),s=e.find("#city"),u=e.find("#zipCode"),f=e.find("#status");return{view:function(){cms.get(`${_url}/${_id}`,null,(function(h){var p;p=h.branch,t.text(`${p.code} - ${p.description}`),n.text(p.code),i.text(p.description),a.text(p.currency_symbol),c.text(p.print_header),d.text(p.tel_no),l.text(p.co_reg_no),r.text(p.address),s.text(p.city?.description),o.text(p.city?.state?.description),u.text(p.zip_code),f.text(p.is_active?"Active":"Inactive"),e.modal("show")}))}}}(),branchForm=function(){let e=$("#branchFormModal"),t=$("#branchFormModalTitle"),n=$("#branchForm"),i=n.find("#branchId"),a=n.find("#name"),c=n.find("#currencySymbol"),d=n.find("#printHeader"),l=n.find("#telNo"),r=n.find("#coRegNo"),o=n.find("#address"),s=n.find("#state"),u=n.find("#city"),f=n.find("#zipCode"),h=n.find("#status"),p=e.find("#saveBranch");return{init:function(){u.select2({placeholder:"Select City",dropdownParent:n}),s.select2({placeholder:"Select State/Region",dropdownParent:n}),p.click((function(){!function(){if(n.parsley().validate()){let e={branchId:i.val(),name:a.val(),currencySymbol:c.val(),printHeader:d.val(),telNo:l.val(),coRegNo:r.val(),address:o.val(),city:u.val(),zipCode:f.val(),status:h.val()};cms.saveForm(_id,e,_url,(function(){branchList.reload(),0==_id&&v()}))}}()})),s.change((function(e,t){const i=this.value;""==i?u.html('<option value="" disabled selected></option>').select2({placeholder:"Select City",dropdownParent:n}):cms.get(`${_rootUrl}/states/${i}/cities`,null,(function(e){u.html('<option value="" disabled selected></option>').select2({placeholder:"Select City",dropdownParent:n,data:e.cities}),null!=t&&u.val(t).trigger("change")}))})),e.on("hidden.bs.modal",(function(){v()}))},view:function(){0==_id?(t.text("Create New Branch"),e.modal("show")):(t.text("Edit Branch Details"),cms.get(`${_url}/${_id}/edit`,null,(function(t){!function(e){i.val(e.code),a.val(e.description),c.val(e.currency_symbol),d.val(e.print_header),l.val(e.tel_no),r.val(e.co_reg_no),o.val(e.address),null!=e.city_id&&s.val(e.city.state_id).trigger("change",e.city_id);f.val(e.zip_code),h.val(e.is_active).trigger("change")}(t.branch),e.modal("show")})))}};function v(){n[0].reset(),n.parsley().reset(),n.find("select").trigger("change")}}(),branchList=function(){let e,t=$("#addBranch"),n=$("#branchesTable");return{init:function(){e=n.DataTable({processing:!0,serverSide:!0,ajax:_url,columns:[{data:null,name:"actions",searchable:!1,orderable:!1},{data:"code",name:"code"},{data:"description",name:"description"},{data:"city",name:"city"},{data:"tel_no",name:"tel_no"},{data:"is_active",name:"is_active",render:function(e){let t="Active",n="success";return 0==e&&(t="Inactive",n="danger"),`<span class="text-${n}">${t}</span>`}}],order:[[1,"asc"]],createdRow:function(e,t,n){let i=$(e);i.find("td:eq(0)").addClass("text-center").html(`<div class="btn-group dropend">\n                        <a href="#" class="dropdown-toggle text-primary" data-bs-toggle="dropdown">\n                        <i class="fa fa-ellipsis-vertical"></i>\n                        </a>\n                        <ul class="dropdown-menu dropdown-menu-end">\n                            <li><button id="edit${t.id}" class="dropdown-item edit fs-11px" type="button">Edit</button></li>\n                            <li><button id="del${t.id}" class="dropdown-item delete fs-11px" type="button">Delete</button></li>\n                        </ul>\n                    </div>`),i.find("td:eq(1)").html(`<a href="javascript:;" id="view${t.id}" class='view'>${t.code}</a>`)},drawCallback:function(){n.find(".edit").unbind("click").click((function(){_id=this.id.replace("edit",""),branchForm.view()})),n.find(".delete").unbind("click").click((function(){cms.confirm("Delete Branch","Are you sure you want to delete this record?",(()=>{cms.delete(`${_url}/${this.id.replace("del","")}`,null,(()=>{toastr.success("Branch has been deleted.","Delete Branch"),i()}))}))})),n.find(".view").unbind("click").click((function(){_id=this.id.replace("view",""),branchDetails.view()}))},initComplete:function(){$("#branchesTable_filter input").unbind(),$("#branchesTable_filter input").keyup((function(t){13==t.keyCode&&e.search(this.value).draw()}))}}),t.click((function(){_id=0,branchForm.view()}))},reload:i};function i(){e.ajax.reload(null,!1)}}();$((function(){$(document).ready((function(){branchForm.init(),branchList.init()}))}));
