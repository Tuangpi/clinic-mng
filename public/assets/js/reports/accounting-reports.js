var detailedBillingSummaryReport=function(){return{init:function(e,a,n){!function(e,a,n){dtTransactionSummary=$("#detailedBillingSummaryTable").DataTable({footerCallback:function(e){const a=this.api().data(),n=$(e);let r="";a.length>0&&(r=a[0].currency_symbol);const o=cms.numberWithCommas(t(a,"sub_total").toFixed(2));n.find("th:eq(1)").text(r+o)},rowGroup:{dataSrc:["date","patient"],startRender:function(t,e){const a=t.data();return a.pluck("date")[0]==e?cms.formatDate(e):$("<tr/>").append(`<th class="nowrap">${a.pluck("patient")[0]}</th>`).append(`<th>${cms.isNull(a.pluck("nric")[0],"")}</th>`).append(`<th colspan="5">${a.pluck("address")[0]}</th>`)},endRender:function(e,a){const n=e.data();let r="";n.length>0&&(r=n[0].currency_symbol);const o=cms.numberWithCommas(t(n,"sub_total").toFixed(2));return $("<tr/>").append(`<th colspan="5" class="text-end">Total for ${n[0].date==a?cms.formatDate(a):a}</th>`).append(`<th class="text-end">${r}${o}</th>`).append("<th/>")}},paging:!1,info:!1,searching:!1,ordering:!1,processing:!0,serverSide:!0,autoWidth:!0,ajax:{url:`${_url}/detailed-billing-summary-data`,type:"POST",contentType:"application/json; charset=utf-8",data:function(t){return t.startDate=e,t.endDate=a,t.patient=n,JSON.stringify(t)}},columns:[{data:"date",name:"date",visible:!1,render:function(t){return cms.formatDate(t)}},{data:"patient",name:"patient"},{data:"nric",name:"nric"},{data:"address",name:"address"},{data:"item_type",name:"item_type"},{data:"item_name",name:"item_name",class:"nowrap"},{data:"sub_total",name:"sub_total",class:"text-end"},{data:"branch",name:"branch"}],order:[[0,"asc"],[1,"asc"]],createdRow:function(t,e,a){let n=$(t);n.find("td:eq(2)").remove(),n.find("td:eq(1)").remove(),n.find("td:eq(0)").html("").attr("colspan",3),n.find("td:eq(2)").html(`${e.qty} ${e.uom} - ${e.item_name}`),n.find("td:eq(3)").html(`${e.currency_symbol}${null==e.sub_total?"0.00":cms.numberWithCommas(e.sub_total)}`)}})}(e,a,n,showExcludedPaymentMode)},printReport:function(){const t=$($("#detailedBillingSummaryReportContainer").html().replace(/<thead>/g,"").replace(/<\/thead>/g,"").replace(/<tfoot>/g,"").replace(/<\/tfoot>/g,""));t.find(".table").attr("class","print-table border-top border-end border-dark fs-10px").width("100%").find("td,th").addClass("p-1 border-bottom border-start border-dark"),$("#printBody").html(t),$("#printContainer").print()}};function t(t,e){return t.pluck(e).reduce((function(t,e){return parseFloat(cms.isNull(t,0))+parseFloat(cms.isNull(e,0))}),0)}}(),owingTransactionReport=function(){return{init:function(e,a,n){!function(e,a,n){dtTransactionSummary=$("#owingTransactionTable").DataTable({footerCallback:function(e){const a=this.api().data(),n=$(e);let r="";a.length>0&&(r=a[0].currency_symbol);const o=cms.numberWithCommas(t(a,"price").toFixed(2)),i=cms.numberWithCommas(t(a,"remaining_balance").toFixed(2));n.find("th:eq(1)").text(r+o),n.find("th:eq(2)").text(r+i)},rowGroup:{startRender:function(t,e){return cms.formatDate(e)},endRender:function(e,a){const n=e.data();let r="";n.length>0&&(r=n[0].currency_symbol);const o=cms.numberWithCommas(t(n,"price").toFixed(2)),i=cms.numberWithCommas(t(n,"remaining_balance").toFixed(2));return $("<tr/>").append(`<th colspan="5">Total for ${cms.formatDate(a)}</th>`).append(`<th class="text-end">${r}${o}</th>`).append(`<th class="text-end">${r}${i}</th>`).append("<th/>")},dataSrc:"date"},paging:!1,info:!1,searching:!1,ordering:!1,processing:!0,serverSide:!0,ajax:{url:`${_url}/owing-transaction-data`,type:"POST",contentType:"application/json; charset=utf-8",data:function(t){return t.startDate=e,t.endDate=a,t.patient=n,JSON.stringify(t)}},columns:[{data:"date",name:"date",visible:!1,render:function(t){return cms.formatDate(t)}},{data:"time_in",name:"time_in",render:function(t){return cms.formatTime(t)}},{data:"ref_no",name:"ref_no"},{data:"patient",name:"patient"},{data:"item_code",name:"item_code"},{data:"name",name:"name"},{data:"price",name:"price"},{data:"remaining_balance",name:"remaining_balance"},{data:"branch",name:"branch"}],order:[[0,"asc"],[1,"asc"]],createdRow:function(t,e,a){let n=$(t);n.find("td:eq(1)").html(`<a href="/queue?id=${e.queue_id}" target="_blank" class="print-no-underline">${e.ref_no}</a>`),n.find("td:eq(5)").html(`${e.currency_symbol}${null==e.price?"0.00":cms.numberWithCommas(e.price)}`),n.find("td:eq(6)").html(`${e.currency_symbol}${null==e.remaining_balance?"0.00":cms.numberWithCommas(e.remaining_balance)}`)}})}(e,a,n,showExcludedPaymentMode)},printReport:function(){const t=$($("#owingReportReportContainer").html().replace(/<thead>/g,"").replace(/<\/thead>/g,"").replace(/<tfoot>/g,"").replace(/<\/tfoot>/g,""));t.find(".table").attr("class","print-table border-top border-end border-dark fs-10px").width("100%").find("td,th").addClass("p-1 border-bottom border-start border-dark"),$("#printBody").html(t),$("#printContainer").print()}};function t(t,e){return t.pluck(e).reduce((function(t,e){return parseFloat(cms.isNull(t,0))+parseFloat(cms.isNull(e,0))}),0)}}(),transactionSummaryReport=function(){let t,e,a;return{init:function(r,o,i,d,m){d?$("#voidedTransaction").show():$("#voidedTransaction").hide();(function(e,a,r,o){t=$("#transactionSummaryTable").DataTable({footerCallback:function(t){const e=this.api().data(),a=$(t);let r="";e.length>0&&(r=e[0].currency_symbol);const o=cms.numberWithCommas(n(e,"paid_amount").toFixed(2)),i=cms.numberWithCommas(n(e,"overall_disc_amount").toFixed(2)),d=cms.numberWithCommas(n(e,"px_credit").toFixed(2));a.find("th:eq(1)").text(r+o),a.find("th:eq(2)").text(r+i),a.find("th:eq(3)").text(r+d)},rowGroup:{startRender:function(t,e){return cms.formatDate(e)},endRender:function(t,e){const a=t.data();let r="";a.length>0&&(r=a[0].currency_symbol);const o=cms.numberWithCommas(n(a,"paid_amount").toFixed(2)),i=cms.numberWithCommas(n(a,"overall_disc_amount").toFixed(2)),d=cms.numberWithCommas(n(a,"px_credit").toFixed(2));return $("<tr/>").append(`<th colspan="4">Total for ${cms.formatDate(e)}</th>`).append(`<th class="text-end">${r}${o}</th>`).append(`<th class="text-end">${r}${i}</th>`).append(`<th class="text-end">${r}${d}</th>`).append("<th/>")},dataSrc:"date"},paging:!1,info:!1,searching:!1,ordering:!1,processing:!0,serverSide:!0,ajax:{url:`${_url}/transaction-summary-data`,type:"POST",contentType:"application/json; charset=utf-8",data:function(t){return t.startDate=e,t.endDate=a,t.patient=r,t.showExcludedPaymentMode=o,JSON.stringify(t)}},columns:[{data:"date",name:"date",visible:!1,render:function(t){return cms.formatDate(t)}},{data:"time_in",name:"time_in",render:function(t){return cms.formatTime(t)}},{data:"ref_no",name:"ref_no"},{data:"patient",name:"patient"},{data:"modes",name:"modes",render:function(t){return`<div>${cms.isNull(t).split("|").join("<br/>")}</div>`}},{data:"paid_amount",name:"paid_amount",className:"text-end"},{data:"overall_disc_amount",name:"overall_disc_amount",className:"text-end"},{data:"px_credit",name:"px_credit",className:"text-end"},{data:"branch",name:"branch"}],order:[[0,"asc"],[1,"asc"]],createdRow:function(t,e,a){let n=$(t);n.find("td:eq(4)").html(`${e.currency_symbol}${null==e.paid_amount?"0.00":cms.numberWithCommas(e.paid_amount)}`),e.paid_amount<0&&n.find("td:eq(4)").addClass("text-danger"),n.find("td:eq(5)").html(`${e.currency_symbol}${null==e.overall_disc_amount?"0.00":cms.numberWithCommas(e.overall_disc_amount)}`),n.find("td:eq(6)").html(`${e.currency_symbol}${null==e.px_credit?"0.00":cms.numberWithCommas(e.px_credit)}`)}})})(r,o,i,m),function(t,a,n,r){e=$("#voidedTransactionTable").DataTable({paging:!1,info:!1,searching:!1,ordering:!1,processing:!0,serverSide:!0,ajax:{url:`${_url}/voided-transaction-data`,type:"POST",contentType:"application/json; charset=utf-8",data:function(e){return e.startDate=t,e.endDate=a,e.patient=n,e.includeVoidedTransaction=r?1:0,JSON.stringify(e)}},columns:[{data:"time_in",name:"time_in",render:function(t){return cms.formatDateTime(t)}},{data:"code",name:"code"},{data:"patient",name:"patient"},{data:"modes",name:"modes",render:function(t){return`<div>${cms.isNull(t).split("|").join("<br/>")}</div>`}},{data:"paid_amount",name:"paid_amount",className:"text-end"},{data:"overall_disc_amount",name:"overall_disc_amount",className:"text-end"},{data:"px_credit",name:"px_credit",className:"text-end"},{data:"voided_by",name:"voided_by"},{data:"branch",name:"branch"}],order:[[0,"asc"]],createdRow:function(t,e,a){let n=$(t);n.find("td:eq(4)").html(`${e.currency_symbol}${null==e.paid_amount?"0.00":cms.numberWithCommas(e.paid_amount)}`),n.find("td:eq(5)").html(`${e.currency_symbol}${null==e.overall_disc_amount?"0.00":cms.numberWithCommas(e.overall_disc_amount)}`),n.find("td:eq(6)").html(`${e.currency_symbol}${null==e.px_credit?"0.00":cms.numberWithCommas(e.px_credit)}`)}})}(r,o,i,d),function(t,e,r,o){a=$("#paymentModesTable").DataTable({footerCallback:function(t){const e=this.api().data(),a=$(t);let r="";e.length>0&&(r=e[0].currency_symbol);const o=cms.numberWithCommas(n(e,"amount").toFixed(2));a.find("th:eq(1)").text(r+o)},paging:!1,searching:!1,ordering:!1,info:!1,processing:!0,serverSide:!0,ajax:{url:`${_url}/transaction-summary-payment-mode-data`,type:"POST",contentType:"application/json; charset=utf-8",data:function(a){return a.startDate=t,a.endDate=e,a.patient=r,a.showExcludedPaymentMode=o,JSON.stringify(a)}},columns:[{data:"mode",name:"mode"},{data:"amount",name:"amount",className:"text-end"}],order:[[0,"asc"]],createdRow:function(t,e,a){let n=$(t);n.find("td:eq(1)").html(`${e.currency_symbol}${null==e.amount?"0.00":cms.numberWithCommas(e.amount)}`),e.amount<0&&n.find("td:eq(1)").addClass("text-danger")}})}(r,o,i,m)},printReport:function(){const t=$($("#transactionSummaryReportContainer").html().replace(/<thead>/g,"").replace(/<\/thead>/g,"").replace(/<tfoot>/g,"").replace(/<\/tfoot>/g,""));t.find(".table").attr("class","print-table border-top border-end border-dark fs-10px").width("100%").find("td,th").addClass("p-1 border-bottom border-start border-dark"),$("#printBody").html(t),$("#printContainer").print()}};function n(t,e){return t.pluck(e).reduce((function(t,e){return parseFloat(cms.isNull(t,0))+parseFloat(cms.isNull(e,0))}),0)}}();$((function(){const t=$("#reportType"),e=$("#drFilter"),a=$(".transaction-summary-filter-container"),n=$("#includeVoidedTransaction"),r=$("#showExcludedPaymentMode"),o=$("#patientFilter"),i=$("#reportContainer"),d=$("#clearFilter"),m=$("#generate"),c=$("#print");let s;$(document).ready((function(){!function(){const t=moment();e.find("span").text(`${t.format("MMMM D, YYYY")} - ${t.format("MMMM D, YYYY")}`),e.daterangepicker({startDate:moment(),endDate:moment(),showDropdowns:!0,ranges:{Today:[moment(),moment()],Yesterday:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Last 7 Days":[moment().subtract(6,"days"),moment()],"Last 30 Days":[moment().subtract(29,"days"),moment()],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")],"This Year":[moment().startOf("year"),moment().endOf("year")]}},(function(t,a,n){e.find("span").html(t.format("MMMM D, YYYY")+" - "+a.format("MMMM D, YYYY"))})),s=e.data("daterangepicker"),o.select2({placeholder:"All Patients",closeOnSelect:!1})}(),t.change((function(){if(a.hide(),"Transaction Summary"===t.find("option:selected").text())a.show();setTimeout((()=>{d.trigger("click")}),0)})),t.trigger("change"),d.click((function(){i.html(""),o.val(null).trigger("change")})),m.click((function(){const e=s.startDate.format("YYYY-MM-DD"),a=s.endDate.format("YYYY-MM-DD");i.load(`${t.val()}?startDate=${e}&endDate=${a}`,(function(){switch(t.find("option:selected").text()){case"Transaction Summary":transactionSummaryReport.init(e,a,o.val(),n.is(":checked"),r.is(":checked"));break;case"Owing Transaction":owingTransactionReport.init(e,a,o.val());break;case"Detailed Billing Summary":detailedBillingSummaryReport.init(e,a,o.val())}}))})),c.click((function(){switch(t.find("option:selected").text()){case"Transaction Summary":transactionSummaryReport.printReport();break;case"Owing Transaction":owingTransactionReport.printReport();break;case"Detailed Billing Summary":detailedBillingSummaryReport.printReport()}}))}))}));
