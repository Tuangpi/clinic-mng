var detailedPatientHistoryReport=function(){let t;return{init:function(n){!function(n){t=$("#detailedPatientHistoryTable").DataTable({footerCallback:function(t){const n=this.api().data(),a=$(t);let o="";n.length>0&&(o=n[0].currency_symbol);const i=cms.numberWithCommas(e(n,"total_amount").toFixed(2)),r=cms.numberWithCommas(e(n,"disc_amount").toFixed(2)),d=cms.numberWithCommas(e(n,"sub_total").toFixed(2));a.find("th:eq(1)").text(o+i),a.find("th:eq(3)").text(o+r),a.find("th:eq(4)").text(o+d)},rowGroup:{dataSrc:"patient",startRender:function(t,e){return e},endRender:function(t,n){const a=t.data();let o="";a.length>0&&(o=a[0].currency_symbol);const i=cms.numberWithCommas(e(a,"total_amount").toFixed(2)),r=cms.numberWithCommas(e(a,"disc_amount").toFixed(2)),d=cms.numberWithCommas(e(a,"sub_total").toFixed(2));return $("<tr/>").append(`<th colspan="6" class="text-end">Total for ${n}</th>`).append(`<th class="text-end">${o}${i}</th>`).append("<th/>").append(`<th class="text-end">${o}${r}</th>`).append(`<th class="text-end">${o}${d}</th>`).append('<th colspan="2"/>')}},paging:!1,info:!1,searching:!1,ordering:!1,processing:!0,serverSide:!0,ajax:{url:`${_url}/detailed-patient-history-data`,type:"POST",contentType:"application/json; charset=utf-8",data:function(t){return t.patient=n,JSON.stringify(t)}},columns:[{data:"patient",name:"patient",visible:!1},{data:"date",name:"date",render:function(t){return cms.formatDate(t)}},{data:"item_code",name:"item_code"},{data:"item_name",name:"item_name"},{data:"unit_price",name:"unit_price",class:"text-end"},{data:"qty",name:"qty",class:"text-end",render:function(t){return cms.numberWithCommas(parseFloat(t).toFixed(2))}},{data:"uom",name:"uom"},{data:"total_amount",name:"total_amount",class:"text-end"},{data:"disc_percentage",name:"disc_percentage",class:"text-end",render:function(t){const e=parseFloat(t);return null==t||0==e?"":cms.numberWithCommas(e.toFixed(2))+"%"}},{data:"disc_amount",name:"disc_amount",class:"text-end"},{data:"sub_total",name:"sub_total",class:"text-end"},{data:"queue_id",name:"queue_id"},{data:"branch",name:"branch"}],order:[[0,"desc"]],createdRow:function(t,e,n){let a=$(t);a.find("td:eq(3)").html(`${e.currency_symbol}${null==e.unit_price?"0.00":cms.numberWithCommas(parseFloat(e.unit_price).toFixed(2))}`),a.find("td:eq(6)").html(`${e.currency_symbol}${null==e.total_amount?"0.00":cms.numberWithCommas(parseFloat(e.total_amount).toFixed(2))}`),a.find("td:eq(8)").html(`${e.currency_symbol}${null==e.disc_amount?"0.00":cms.numberWithCommas(parseFloat(e.disc_amount).toFixed(2))}`),a.find("td:eq(9)").html(`${e.currency_symbol}${null==e.sub_total?"0.00":cms.numberWithCommas(parseFloat(e.sub_total).toFixed(2))}`)}})}(n)},printReport:function(){const t=$($("#detailedPatientHistoryReportContainer").html().replace(/<thead>/g,"").replace(/<\/thead>/g,"").replace(/<tfoot>/g,"").replace(/<\/tfoot>/g,""));t.find(".table").attr("class","print-table border-top border-end border-dark fs-10px").width("100%").find("td,th").addClass("p-1 border-bottom border-start border-dark"),$("#printBody").html(t),$("#printContainer").print()}};function e(t,e){return t.pluck(e).reduce((function(t,e){return parseFloat(cms.isNull(t,0))+parseFloat(cms.isNull(e,0))}),0)}}();$((function(){const t=$("#reportType"),e=$("#patientFilter"),n=$("#reportContainer"),a=$("#clearFilter"),o=$("#generate"),i=$("#print");$(document).ready((function(){e.select2({placeholder:"All Patients",closeOnSelect:!1}),t.change((function(){setTimeout((()=>{a.trigger("click")}),0)})),a.click((function(){n.html(""),e.val(null).trigger("change")})),o.click((function(){n.load(`${t.val()}`,(function(){if("Detailed Patient History"===t.find("option:selected").text())detailedPatientHistoryReport.init(e.val())}))})),i.click((function(){if("Detailed Patient History"===t.find("option:selected").text())detailedPatientHistoryReport.printReport()}))}))}));
